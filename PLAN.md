## 青丝源进销存助手 - 开发路线（Roadmap）

### 目标与范围
- 为中老年美发店提供轻量级进销存：进货、库存、配方、取货登记、费用统计、账号权限与基础设置。
- 响应式设计：移动优先，兼容手机与桌面；遵循尼尔森 10 大可用性原则。

### 总体架构
- 前端：Vue 3 + Vite + Pinia + Vue Router + Element Plus（按需）
  - 移动优先样式，栅格布局 + clamp 流式字号；触控命中区 ≥ 48px。
  - 组件：仪表盘、进货表单、库存卡片/表格、配方编辑器、取货步骤流、统计图表（ECharts）。
- 后端：Node.js + Express
  - 鉴权：JWT（店长/店员），路由中间件与前端路由守卫双校验。
  - 存储：JSON 文件存储抽象层（可替换为 SQLite/低代码 DB），库存流水建模。
  - 服务：材料、产品+配方、订单（出库）、进货（入库）、统计报表、用户与权限。
- 通信：RESTful API + Bearer Token；跨域与安全头。

### 数据与关键规则
- 实体
  - Material: id, name, unit("g"), stock, threshold
  - Product: id, name, priceBase, recipe[{ materialId, grams }]
  - Order: id, type(self|vip|distrib|event), productId, qty, person, receivable, payment, createdAt
  - InventoryLog: id, kind(in|out), materialId, grams, refType(order|purchase), refId, createdAt
  - Purchase: id, materialId, grams, cost, createdAt
  - User: id, role(owner|staff), name, phone, status
- 规则
  - 创建订单：按配方×数量扣减对应原料；库存不足阻止提交并给出可恢复错误。
  - 定价策略：基础价 × 折扣（VIP 0.8、分销 0.7、活动自定义）；支持覆盖与四舍五入规则。
  - 库存预警：按 threshold 计算，首页与库存列表展示提醒。

### 迭代里程碑
- M0 基础设施
  - 前端工程化、主题与移动基线、全局反馈；后端框架、日志、错误中间件、CORS、安全头；CI（Lint/Format）。
- M1 登录与仪表
  - 登录/登出/会话保持、权限模型；首页展示今日取货数、库存预警、快捷入口；移动/桌面导航自适配。
- M2 取货登记（核心闭环）
  - 步骤流：类型→产品→取货人→费用→提交；定价策略与库存扣减；订单编号、支付标记与成功反馈。
- M3 进货与库存
  - 入库表单、库存实时视图（搜索/排序）、预警阈值配置、库存流水明细。
- M4 配方与产品
  - 产品基础信息与售价；配方编辑（原料+克数）与调用记录；库存足量性预校验。
- M5 费用统计与导出
  - 日/周/月 + 类型筛选；应收与成本及毛利试算；CSV/Excel 导出。
- M6 账号与设置
  - 店员管理（增删改、重置密码/状态）、修改密码、关于与反馈。
- M7 可用性与无障碍
  - 尼尔森 10 项落实、键盘可达/焦点环、空态/加载态/骨架屏、语义标签与对比度。

### 响应式与可用性要点
- 断点：360/768/1024/1440；容器宽度与栅格自适配；表格在移动端折叠为卡片。
- 视觉：信息层级清晰；主按钮绿色、警告红色；字号不小于 16px；状态反馈 150–300ms。
- 交互：撤销/返回上一步；错误可恢复与场景化说明；默认值与历史建议降低记忆负担。

### 质量与验收
- 单元/集成：扣减、定价、统计、鉴权用例覆盖。
- 可用性走查：按 UX_CHECKLIST.md；A11y 快速评估（焦点环、对比度、键盘流）。
- 性能：LCP/CLS 基线；资源按需与懒加载；图表与表格虚拟化策略预留。

### 风险与应对
- 数据一致性：采用库存流水 + 事务（或补偿逻辑）保证最终一致。
- 设备适配：优先移动端，桌面视图延展；真实设备走查。
- 数据迁移：JSON → SQLite 迁移脚本与抽象层兼容。

### 下一步（执行起点）
- 定价策略与库存扣减接口实现 → 前端取货步骤接入 → 首页预警联动。
